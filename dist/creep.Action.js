// base class for every action
let t=function(t){this.name=t,this.maxPerTarget=1/0,this.maxPerAction=1/0,this.targetRange=1,this.reachedRange=1,this.renewTarget=!0,this.getTargetId=function(t){return t.id||t.name},this.getTargetById=function(t){return Game.getObjectById(t)||Game.spawns[t]||Game.flags[t]},this.isValidAction=function(t){return!0},this.isValidTarget=function(t,e){return null!=t},this.isAddableAction=function(t){return this.maxPerAction===1/0||!t.room.population||!t.room.population.actionCount[this.name]||t.room.population.actionCount[this.name]<this.maxPerAction},this.isAddableTarget=function(t,e){return!t.targetOf||this.maxPerTarget===1/0||_.filter(t.targetOf,{actionName:this.name}).length<this.maxPerTarget},this.newTarget=function(t){return null},this.step=function(t){global.CHATTY&&t.say(this.name,global.SAY_PUBLIC);let e=t.pos.getRangeTo(t.target);if(e<=this.targetRange){var i=this.work(t);if(i!=OK){t.action,t.target;return t.action=null,t.target=null,void t.handleError({errorCode:i,action:this,target:t.target,range:e,creep:t})}e=t.pos.getRangeTo(t.target)}if(t.target&&t.hasActiveBodyparts(MOVE))if(e>this.targetRange)t.travelTo(t.target,{range:this.targetRange});else if(e>this.reachedRange){const e=t.pos.getDirectionTo(t.target),i=Traveler.positionAtDirection(t.pos,e);t.room.isWalkable(i.x,i.y)?t.move(e):t.pos.isNearTo(t.target)||t.travelTo(t.target,{range:this.reachedRange})}},this.work=function(t){return ERR_INVALID_ARGS},this.validateActionTarget=function(t,e){if(this.isValidAction(t)){if(this.isValidTarget(e,t))return e;if(this.renewTarget)return delete t.data.path,this.newTarget(t)}return null},this.assign=function(t,e){return void 0===e&&(e=this.newTarget(t)),!(!e||!this.isAddableTarget(e,t))&&(global.DEBUG&&global.TRACE&&trace("Action",{creepName:t.name,assign:this.name,target:!e||e.name||e.id,Action:"assign"}),t.action&&t.action.name==this.name&&t.target&&t.target.id===e.id&&t.target.name==e.name||(Population.registerAction(t,this,e),this.onAssignment(t,e)),!0)},this.onAssignment=function(t,e){global.SAY_ASSIGNMENT&&ACTION_SAY[this.name.toUpperCase()]&&t.say(ACTION_SAY[this.name.toUpperCase()],global.SAY_PUBLIC),(e instanceof RoomObject||e instanceof RoomPosition&&VISUALS.ACTION_ASSIGNMENT)&&Visuals.drawArrow(t,e)},this.defaultStrategy={name:`default-${t}`,moveOptions:function(t){return t||{}}},this.selectStrategies=function(){return[this.defaultStrategy]},this.isMember=function(t){return _.find(t,function(t){return t.name===this.name},this)},this.getStrategy=function(t,e,...i){return _.isUndefined(i)?e.getStrategyHandler([this.name],t):e.getStrategyHandler([this.name],t,...i)}};module.exports=t;
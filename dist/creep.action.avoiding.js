const t=new Creep.Action("avoiding");module.exports=t,t.lairDangerTime=24,t.lairDangerRange=14,t.targetRange=0,t.reachedRange=0,t.isActiveLair=function(e){return!_.isUndefined(e.ticksToSpawn)&&e.ticksToSpawn<=t.lairDangerTime},t.isValidAction=function(t){return t.data.destiny&&t.data.destiny.room===t.room.name&&(Room.isSKRoom(t.room.name)||t.room.situation.invasion)},t.isAddableAction=function(t){return!0},t.isValidTarget=function(e,a){return Task.reputation.npcOwner(e)?_.isUndefined(e.ticksToSpawn)||t.isActiveLair(e):!(!Task.reputation.hostileOwner(e)||!e.hasActiveBodyparts)&&e.hasActiveBodyparts([ATTACK,RANGED_ATTACK])},t.newTarget=function(e){if(Room.isSKRoom(e.pos.roomName)){const a=_.first(e.room.find(FIND_STRUCTURES,{filter:function(a){return t.isActiveLair(a)&&e.pos.getRangeTo(a.pos)<=t.lairDangerRange}}));if(a)return a}if(e.room.situation.invasion){const a=_.chain(e.room.hostiles).filter(function(e){return t.isValidTarget(e)}).map(function(t){let a=0;const o=e.pos.getRangeTo(t);return a="Invader"===e.owner.username?o-51:o<10?o-11:0,{target:t,score:a}}).filter("score").sortBy("score").first().get("target").value();if(a)return a}},t.work=function(t){if(!t.data.safeSpot||!t.data.safeSpot.roomName){const e=t.data.destiny&&Game.flags[t.data.destiny.targetName];if(e)t.data.safeSpot=e.pos;else{const e=_.chain(t.room.findRoute(t.data.homeRoom)).first().get("exit").value();e&&(t.data.safeSpot=t.pos.findClosestByRange(e),t.data.safeSpot.roomName=t.pos.roomName)}}t.data.safeSpot&&(t.pos.getRangeTo(t.target)<10?t.travelTo(t.data.safeSpot):t.idleMove())},t.run=function(e){if(t.isValidAction(e)&&(e.action===t&&t.isValidTarget(e.target,e)||t.isAddableAction(e)&&t.assign(e)))return!!e.leaveBorder()||(t.work(e),!0)};
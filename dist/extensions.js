let e={};e.extend=function(){Object.defineProperty(Structure.prototype,"towers",{configurable:!0,get:function(){return(_.isUndefined(this._towers)||this._towersSet!=Game.time)&&(this._towersSet=Game.time,this._towers=[]),this._towers},set:function(e){this._towers=e}}),Object.defineProperty(Structure.prototype,"active",{configurable:!0,get(){return Util.get(this.room.memory,["structures",this.id,"active"],this.isActive())}}),Object.defineProperty(Source.prototype,"memory",{configurable:!0,get:function(){if(_.isUndefined(Memory.sources)&&(Memory.sources={}),_.isObject(Memory.sources))return Memory.sources[this.id]=Memory.sources[this.id]||{}},set:function(e){if(_.isUndefined(Memory.sources)&&(Memory.sources={}),!_.isObject(Memory.sources))throw new Error("Could not set memory extension for sources");Memory.sources[this.id]=e}}),Object.defineProperty(RoomPosition.prototype,"adjacent",{configurable:!0,get:function(){if(_.isUndefined(this._adjacent)){this._adjacent=[];for(let e=this.x-1;e<this.x+2;e++)for(let t=this.y-1;t<this.y+2;t++)e>0&&e<49&&t>0&&t<49&&this._adjacent.push(new RoomPosition(e,t,this.roomName))}return this._adjacent}}),Object.defineProperty(RoomPosition.prototype,"radius",{configurable:!0,value:function(e=1){if(1===e)return this.adjacent;if(e<1)return[this];const t=[];for(let r=this.x-e;r<=this.x+e;r++)for(let i=this.y-e;i<=this.y+e;i++){const e=new RoomPosition(r,i,this.roomName);50>r&&r>0&&0<i&&i<50&&!_.isEqual(this,e)&&t.push(e)}return t}}),Object.defineProperty(RoomObject.prototype,"accessibleFields",{configurable:!0,get:function(){if(this.memory&&!_.isUndefined(this.memory.accessibleFields))return this.memory.accessibleFields;{var e=this.room.lookForAtArea(LOOK_TERRAIN,this.pos.y-1,this.pos.x-1,this.pos.y+1,this.pos.x+1,!0);let r=_.countBy(e,"terrain").wall;var t=void 0===r?9:9-r;return this.memory?this.memory.accessibleFields=t:t}}}),Object.defineProperty(RoomObject.prototype,"cloak",{configurable:!0,get:function(){const e=Memory.cloaked[this.id];return!!e&&(_.isNumber(e)&&Game.time>e?(delete Memory.cloaked[this.id],!1):e)},set:function(e){return e?(_.isNumber(e)?e<Game.time&&(e=Game.time+e):e=!0,Memory.cloaked[this.id]=e):void delete Memory.cloaked[this.id]}}),Object.defineProperty(Source.prototype,"container",{configurable:!0,get:function(){return _.isUndefined(this.memory.container)&&this.room.saveContainers(),_.isUndefined(this._container)&&(this.memory.storage?(this._container=Game.getObjectById(this.memory.storage),this._container||delete this.memory.storage):this.memory.terminal?(this._container=Game.getObjectById(this.memory.terminal),this._container||delete this.memory.terminal):this.memory.container?(this._container=Game.getObjectById(this.memory.container),this._container||delete this.memory.container):this._container=null),this._container}}),Object.defineProperty(Mineral.prototype,"memory",{configurable:!0,get:function(){if(_.isUndefined(Memory.minerals)&&(Memory.minerals={}),_.isObject(Memory.minerals))return Memory.minerals[this.id]=Memory.minerals[this.id]||{}},set:function(e){if(_.isUndefined(Memory.minerals)&&(Memory.minerals={}),!_.isObject(Memory.minerals))throw new Error("Could not set memory extension for minerals");Memory.minerals[this.id]=e}}),Object.defineProperty(Mineral.prototype,"container",{configurable:!0,get:function(){return _.isUndefined(this.memory.container)&&this.room.saveContainers(),_.isUndefined(this._container)&&(this.memory.terminal?(this._container=Game.getObjectById(this.memory.terminal),this._container||delete this.memory.terminal):this.memory.storage?(this._container=Game.getObjectById(this.memory.storage),this._container||delete this.memory.storage):this.memory.container?(this._container=Game.getObjectById(this.memory.container),this._container||delete this.memory.container):this._container=null),this._container}}),Object.defineProperty(Source.prototype,"link",{configurable:!0,get:function(){return _.isUndefined(this._link)&&(this.memory.link?(this._link=Game.getObjectById(this.memory.link),this._link||delete this.memory.link):this._link=null),this._link}}),Object.defineProperty(StructureController.prototype,"memory",{configurable:!0,get:function(){if(_.isUndefined(Memory.controllers)&&(Memory.controllers={}),_.isObject(Memory.controllers))return Memory.controllers[this.id]=Memory.controllers[this.id]||{}},set:function(e){if(_.isUndefined(Memory.controllers)&&(Memory.controllers={}),!_.isObject(Memory.controllers))throw new Error("Could not set memory extension for controller");Memory.controllers[this.id]=e}}),Object.defineProperty(StructureStorage.prototype,"sum",{configurable:!0,get:function(){return(_.isUndefined(this._sum)||this._sumSet!=Game.time)&&(this._sumSet=Game.time,this._sum=_.sum(this.store)),this._sum}}),Object.defineProperty(StructureStorage.prototype,"charge",{configurable:!0,get:function(){return Util.chargeScale(this.store.energy,MIN_STORAGE_ENERGY[this.room.controller.level],MAX_STORAGE_ENERGY[this.room.controller.level])}}),StructureStorage.prototype.getNeeds=function(e){var t=0;if(!this.room.memory.resources)return 0;let r=this.room.memory.resources.storage[0],i=null;r&&(i=r.orders.find(t=>{return t.type==e})),i||(i={orderAmount:0,orderRemaining:0,storeAmount:0});let o=this.room.controller.level,n=Math.max(i.orderRemaining+(this.store[e]||0),i.storeAmount+(e==RESOURCE_ENERGY?MIN_STORAGE_ENERGY[o]:MAX_STORAGE_MINERAL)),s=e==RESOURCE_ENERGY?this.storeCapacity-this.sum+this.store.energy:i.orderAmount+i.storeAmount+MAX_STORAGE_MINERAL;s<0&&(s=0);let m=this.store[e]||0;return m<n?t=Math.min(n-m,this.storeCapacity-this.sum):m>1.05*s&&(t=s-m),t},Object.defineProperty(StructureTerminal.prototype,"sum",{configurable:!0,get:function(){return(_.isUndefined(this._sum)||this._sumSet!=Game.time)&&(this._sumSet=Game.time,this._sum=_.sum(this.store)),this._sum}}),Object.defineProperty(StructureTerminal.prototype,"charge",{configurable:!0,get:function(){const e=this.getNeeds(RESOURCE_ENERGY),t=e?this.store[RESOURCE_ENERGY]+e:TERMINAL_ENERGY;return Util.chargeScale(this.store.energy,t,2*t)}}),StructureTerminal.prototype.getNeeds=function(e){var t=0;if(!this.room.memory.resources)return 0;let r=this.room.memory.resources.terminal[0],i=null;r&&(i=r.orders.find(t=>{return t.type==e})),i||(i={orderAmount:0,orderRemaining:0,storeAmount:0});let o=Math.max(i.orderRemaining+(this.store[e]||0),i.storeAmount+(e==RESOURCE_ENERGY?TERMINAL_ENERGY:0)),n=i.orderAmount+i.storeAmount+(e==RESOURCE_ENERGY?TERMINAL_ENERGY:0);n<0&&(n=0);let s=this.store[e]||0;return s<o?t=Math.min(o-s,this.storeCapacity-this.sum):s>1.05*n&&(t=n-s),t},Object.defineProperty(StructureContainer.prototype,"sum",{configurable:!0,get:function(){return(_.isUndefined(this._sum)||this._sumSet!=Game.time)&&(this._sumSet=Game.time,this._sum=_.sum(this.store)),this._sum}}),StructureContainer.prototype.getNeeds=function(e){if(!this.room.memory.resources)return 0;let t=this.room.memory.resources.container.find(e=>e.id==this.id);if(t){let r=t.orders.find(t=>{return t.type==e});if(r){let t=Math.max(r.orderRemaining+(this.store[e]||0),r.storeAmount),i=r.orderAmount+r.storeAmount;i<0&&(i=0);let o=this.store[e]||0;if(o<t)return Math.min(t-o,this.storeCapacity-this.sum);if(o>1.05*i)return i-o}}return 0},StructureLab.prototype.getNeeds=function(e){if(!this.room.memory.resources)return 0;let t=0,r=0,i=this.room.memory.resources.lab.find(e=>e.id==this.id);if(i){let o=i.orders.find(t=>{return t.type==e});if(o){let i=0;e==RESOURCE_ENERGY?i=this.energy:e==this.mineralType&&(i=this.mineralAmount),t=Math.max(o.orderRemaining+i,o.storeAmount),r=o.orderAmount+o.storeAmount,r<0&&(r=0)}}let o=0,n=0,s=0;if(e==RESOURCE_ENERGY?(o=this.energy,n=this.energyCapacity-this.energy,s=this.energyCapacity):(this.mineralType==e&&(o=this.mineralAmount),n=this.mineralCapacity-this.mineralAmount,s=this.mineralCapacity),o<Math.min(t,s)/2)return Math.min(t-o,n);if(i&&i.reactionType===this.mineralType){if(o>r+(s-Math.min(r,s))/2)return r-o}else if(o>r)return r-o;return 0},StructurePowerSpawn.prototype.getNeeds=function(e){if(FILL_POWERSPAWN)return e==RESOURCE_ENERGY&&this.energy<.75*this.energyCapacity?this.energyCapacity-this.energy:e==RESOURCE_POWER&&this.power<.25*this.powerCapacity?this.powerCapacity-this.power:0;if(!this.room.memory.resources||!this.room.memory.resources.powerSpawn)return 0;let t=0,r=0,i=this.room.memory.resources.powerSpawn.find(e=>e.id==this.id);if(i){let o=i.orders.find(t=>{return t.type==e});if(o){let i=0;e==RESOURCE_ENERGY?i=this.energy:e==RESOURCE_POWER&&(i=this.power),t=Math.max(o.orderRemaining+i,o.storeAmount),r=o.orderAmount+o.storeAmount,r<0&&(r=0)}}let o=0,n=0;return e==RESOURCE_ENERGY?(o=this.energy,n=this.energyCapacity-this.energy):e==RESOURCE_POWER&&(o=this.power,n=this.powerCapacity-this.power),o<t?Math.min(t-o,n):o>1.05*r?r-o:0},void 0===Memory.pavementArt&&(Memory.pavementArt={})},module.exports=e;
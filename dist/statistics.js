let t={};module.exports=t,t.storedStatisticsTime=Memory.statistics&&Memory.statistics.time?Memory.statistics.time:0,t.process=function(){_.isUndefined(Memory.statistics)&&(Memory.statistics={reports:[]});let t;SEND_STATISTIC_REPORTS&&this.storedStatisticsTime>0&&(t="<div><h3><b>Status report </b></h3><h4>at "+toDateTimeString(toLocalDate())+",<br/>comparison to state before: "+this.toTimeSpanString(new Date,new Date(this.storedStatisticsTime))+" ("+(Game.time-Memory.statistics.tick)+" loops)</h4>",Game.cpu.bucket&&(bucketDif=Game.cpu.bucket-Memory.statistics.bucket,t+="CPU Bucket: "+Game.cpu.bucket+" ("+(bucketDif>=0?"+":"")+bucketDif+")"),t+="</div>",Memory.statistics.reports.push(t));let e=e=>{let s="<li>"+e.owner+": "+e.body.replace(/"/g,"");s+=void 0===e.leave?" since "+toTimeString(toLocalDate(new Date(e.time)))+"</li>":" for "+(e.leave-e.enter)+" loops at "+toTimeString(toLocalDate(new Date(e.time)))+"</li>",t.length+s.length>REPORT_MAX_LENGTH?(Memory.statistics.reports.push(t+"</ul></li></ul>"),t='<ul><li style="list-style-type:none"><ul>'+s):t+=s},s=s=>{if(s.controller){if(SEND_STATISTIC_REPORTS&&this.storedStatisticsTime>0)if(s.controller.my&&s.memory.statistics){t="<ul><li><b>Room "+s.name+"</b><br/><u>Controller</u><ul>";let o=s.controller.progress<s.memory.statistics.controllerProgress,r=(100*s.controller.progress/s.controller.progressTotal).toFixed(0),i=o?s.memory.statistics.controllerProgressTotal-s.memory.statistics.controllerProgress+s.controller.progress:s.controller.progress-s.memory.statistics.controllerProgress,l=(100*i/s.controller.progressTotal).toFixed(1),a=(i/(Game.time-Memory.statistics.tick)).toFixed(2);if(t+="<li>Level "+s.controller.level+", "+r+"% of "+s.controller.progressTotal+"<br/>( +"+i+" | +"+l+"% | +"+a+"/loop )"+(o?" <b><i>Upgraded!</i></b></li></ul>":"</li></ul>"),s.storage&&s.memory.statistics.store){let e=s.memory.statistics.store,o=s.storage.store;t+="<u>Storage</u><ul>";for(let r in e){let s=o[r]?o[r]-e[r]:e[r]*-1;t+="<li>"+r+": "+(o[r]||0)+" ("+(s>-1?"+":"")+s+")</li>"}for(let r in o)e[r]||(t+="<li>"+r+": "+o[r]+" (+"+o[r]+")</li>");t+="</ul>"}s.memory.statistics.invaders&&s.memory.statistics.invaders.length>0&&(t+="<u>Invaders</u><ul>",_.forEach(s.memory.statistics.invaders,e),t+="</ul>"),t+="</li></ul>",Memory.statistics.reports.push(t)}else!s.controller.my&&s.controller.reservation&&(t="<ul><li><b>Room "+s.name+"</b><br/><u>Controller</u><ul><li>Reservation: "+s.controller.reservation.ticksToEnd+" for "+s.controller.reservation.username+"</li></ul></li></ul>",Memory.statistics.reports.push(t));let o=t=>void 0===t.leave,r=s.memory.statistics?_.filter(s.memory.statistics.invader,o):[];s.memory.statistics={tick:Game.time,time:Date.now(),store:s.storage?s.storage.store:null,controllerProgress:s.controller.progress,controllerProgressTotal:s.controller.progressTotal,invaders:r}}};_.forEach(Game.rooms,s),Memory.statistics.tick=Game.time,Memory.statistics.time=Date.now(),Memory.statistics.bucket=Game.cpu.bucket},t.toTimeSpanString=function(t,e){let s=t.getTime()-e.getTime();s<0&&(s*=-1);let o,r=new Date(s),i=Math.floor(s/36e5),l=r.getMinutes(),a=r.getSeconds();return o=i>0?i+"h "+l+"m "+a+"s":l>0?l+"m "+a+"s":a>0?a+"s":"0"};
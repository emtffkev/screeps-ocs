let e={};module.exports=e,e.priorityHigh=[Creep.setup.worker,Creep.setup.miner,Creep.setup.hauler,Creep.setup.upgrader],e.priorityLow=[Creep.setup.mineralMiner,Creep.setup.privateer],e.extend=function(){Spawn.prototype.execute=function(){if(!this.spawning){let e=this.room,r=this,t=t=>{return t.isValidSetup(e)&&r.createCreepBySetup(t)};const n=Util.get(this.room.memory,"spawnDelay",{});let o=this.createCreepByQueue(e.spawnQueueHigh,"High");return o||0!==e.spawnQueueHigh.length&&e.spawnQueueHigh.length!==n.High||Game.time%SPAWN_INTERVAL!==0||(o=_.some(Spawn.priorityHigh,t),o||(o=this.createCreepByQueue(e.spawnQueueMedium,"Medium")),o||0!==e.spawnQueueMedium.length&&e.spawnQueueMedium.length!==n.Medium||(o=_.some(Spawn.priorityLow,t),o||(o=this.createCreepByQueue(e.spawnQueueLow,"Low")))),o}},Spawn.prototype.createCreepBySetup=function(e){DEBUG&&TRACE&&trace("Spawn",{setupType:this.type,rcl:this.room.controller.level,energy:this.room.energyAvailable,maxEnergy:this.room.energyCapacityAvailable,Spawn:"createCreepBySetup"},"creating creep");var r=e.buildParams(this);return this.create(r.parts,r.name,r.setup)?r:null},Spawn.prototype.createCreepByQueue=function(e,r){const t=Util.get(this.room.memory,"spawnDelay",{});if(!e)return null;if(Memory.CPU_CRITICAL&&t[r]===e.length)return null;let n;for(const o in e){const r=e[o];Memory.CPU_CRITICAL&&!CRITICAL_ROLES.includes(r.behaviour)||(n=e.splice(o,1)[0])}if(!n)return e.length&&DEBUG&&global.logSystem(this.pos.roomName,"No non-CRITICAL creeps to spawn, delaying spawn until CPU is not CRITICAL, or new entries are added."),t[r]=e.length,null;delete t[r];let i=0;if(n.parts.forEach(function(e){i+=BODYPART_COST[e]}),0===i)return global.logSystem(this.pos.roomName,dye(CRAYON.error,"Zero parts body creep queued. Removed.")),!1;if(i>this.room.remainingEnergyAvailable)return i>this.room.energyCapacityAvailable||i>300&&!this.room.creeps.length?(global.logSystem(this.pos.roomName,dye(CRAYON.error,"Queued creep too big for room: "+JSON.stringify(n))),!1):(e.unshift(n),!0);for(var a,p=n.name,s=1;null==a||Game.creeps[a]||Memory.population[a];s++)a=n.name+"-"+s;n.name=a;let u=this.create(n.parts,n.name,n.behaviour||n.setup,n.destiny);return u||(n.name=p,e.unshift(n)),u},Spawn.prototype.create=function(e,r,t,n){if(0==e.length)return!1;var o=this.createCreep(e,r,null);if(r==o||void 0===translateErrorCode(o)){let r=0;return e.forEach(function(e){r+=BODYPART_COST[e]}),this.room.reservedSpawnEnergy+=r,Population.registerCreep(o,t,r,this.room,this.name,e,n),this.newSpawn={name:o},Creep.spawningStarted.trigger({spawn:this.name,name:o,body:e,destiny:n,spawnTime:e.length*CREEP_SPAWN_TIME}),CENSUS_ANNOUNCEMENTS&&global.logSystem(this.pos.roomName,dye(CRAYON.birth,"Good morning "+o+"!")),!0}return(DEBUG||CENSUS_ANNOUNCEMENTS)&&global.logSystem(this.pos.roomName,dye(CRAYON.error,"Offspring failed: "+translateErrorCode(o)+"<br/> - body: "+JSON.stringify(_.countBy(e))+"<br/> - name: "+r+"<br/> - behaviour: "+t+"<br/> - destiny: "+n)),!1}},e.register=function(){Creep.spawningCompleted.on(r=>e.handleSpawningCompleted(r))},e.handleSpawningCompleted=function(e){DEBUG&&TRACE&&trace("Spawn",{behaviour:e.data.creepType,creepName:e.name,Spawn:"Creep.spawningCompleted"}),CENSUS_ANNOUNCEMENTS&&global.logSystem(e.pos.roomName,dye(CRAYON.birth,"Off to work "+e.name+"!"))},e.execute=function(){let e=e=>{e.room.my&&e.execute()};_.forEach(Game.spawns,e)};
let e={};module.exports=e,e.priorityHigh=[Creep.setup.worker,Creep.setup.miner,Creep.setup.hauler,Creep.setup.upgrader],e.priorityLow=[Creep.setup.mineralMiner,Creep.setup.privateer],e.extend=function(){Spawn.prototype.execute=function(){if(!this.spawning){let e=this.room,r=this,t=t=>{return t.isValidSetup(e)&&r.createCreepBySetup(t)},n=this.createCreepByQueue(e.spawnQueueHigh);return n||0!=e.spawnQueueHigh.length||Game.time%SPAWN_INTERVAL!=0||(n=_.some(Spawn.priorityHigh,t),n||(n=this.createCreepByQueue(e.spawnQueueMedium)),n||0!=e.spawnQueueMedium.length||(n=_.some(Spawn.priorityLow,t),n||(n=this.createCreepByQueue(e.spawnQueueLow)))),n}},Spawn.prototype.createCreepBySetup=function(e){DEBUG&&TRACE&&trace("Spawn",{setupType:this.type,rcl:this.room.controller.level,energy:this.room.energyAvailable,maxEnergy:this.room.energyCapacityAvailable,Spawn:"createCreepBySetup"},"creating creep");var r=e.buildParams(this);return this.create(r.parts,r.name,r.setup)?r:null},Spawn.prototype.createCreepByQueue=function(e){if(!e||0==e.length)return null;let r=e.shift(),t=0;if(r.parts.forEach(function(e){t+=BODYPART_COST[e]}),0===t)return global.logSystem(this.pos.roomName,dye(CRAYON.error,"Zero parts body creep queued. Removed.")),!1;if(t>this.room.remainingEnergyAvailable)return t>this.room.energyCapacityAvailable||t>300&&!this.room.creeps.length?(global.logSystem(this.pos.roomName,dye(CRAYON.error,"Queued creep too big for room: "+JSON.stringify(r))),!1):(e.unshift(r),!0);for(var n,o=r.name,a=1;null==n||Game.creeps[n]||Memory.population[n];a++)n=r.name+"-"+a;r.name=n;let i=this.create(r.parts,r.name,r.behaviour||r.setup,r.destiny);return i||(r.name=o,e.unshift(r)),i},Spawn.prototype.create=function(e,r,t,n){if(0==e.length)return!1;var o=this.createCreep(e,r,null);if(r==o||void 0===translateErrorCode(o)){let r=0;return e.forEach(function(e){r+=BODYPART_COST[e]}),this.room.reservedSpawnEnergy+=r,Population.registerCreep(o,t,r,this.room,this.name,e,n),this.newSpawn={name:o},Creep.spawningStarted.trigger({spawn:this.name,name:o,body:e,destiny:n,spawnTime:e.length*CREEP_SPAWN_TIME}),CENSUS_ANNOUNCEMENTS&&global.logSystem(this.pos.roomName,dye(CRAYON.birth,"Good morning "+o+"!")),!0}return(DEBUG||CENSUS_ANNOUNCEMENTS)&&global.logSystem(this.pos.roomName,dye(CRAYON.error,"Offspring failed: "+translateErrorCode(o)+"<br/> - body: "+JSON.stringify(_.countBy(e))+"<br/> - name: "+r+"<br/> - behaviour: "+t+"<br/> - destiny: "+n)),!1}},e.register=function(){Creep.spawningCompleted.on(r=>e.handleSpawningCompleted(r))},e.handleSpawningCompleted=function(e){DEBUG&&TRACE&&trace("Spawn",{behaviour:e.data.creepType,creepName:e.name,Spawn:"Creep.spawningCompleted"}),CENSUS_ANNOUNCEMENTS&&global.logSystem(e.pos.roomName,dye(CRAYON.birth,"Off to work "+e.name+"!"))},e.execute=function(){let e=e=>{e.room.my&&e.execute()};_.forEach(Game.spawns,e)};
let e={};module.exports=e,e.tasks=[],e.populate=function(){Task.addTasks(...[Task.attackController,Task.claim,Task.defense,Task.guard,Task.labTech,Task.mining,Task.pioneer,Task.reputation,Task.reserve,Task.robbing])},e.addTasks=((...e)=>Task.tasks.push(...e)),e.installTask=((...e)=>{e.forEach(e=>{Task[e]=load(`task.${e}`),Task.addTasks(Task[e])})}),e.flush=function(){Task.tasks.forEach(e=>{e.flush&&e.flush()})},e.selfRegister=!0,e.register=function(){Task.tasks.forEach(e=>{e.register&&e.register(),e.handleFlagFound&&Flag.found.on(n=>e.handleFlagFound(n)),e.handleFlagRemoved&&Flag.FlagRemoved.on(n=>e.handleFlagRemoved(n)),e.handleSpawningStarted&&Creep.spawningStarted.on(n=>e.handleSpawningStarted(n)),e.handleSpawningCompleted&&Creep.spawningCompleted.on(n=>e.handleSpawningCompleted(n)),e.handleCreepDied&&(Creep.predictedRenewal.on(n=>e.handleCreepDied(n.name)),Creep.died.on(n=>e.handleCreepDied(n))),e.handleCreepError&&Creep.error.on(n=>e.handleCreepError(n)),e.handleNewInvader&&Room.newInvader.on(n=>e.handleNewInvader(n)),e.handleKnownInvader&&Room.knownInvader.on(n=>e.handleKnownInvader(n)),e.handleGoneInvader&&Room.goneInvader.on(n=>e.handleGoneInvader(n)),e.handleRoomDied&&Room.collapsed.on(n=>e.handleRoomDied(n))})},e.memory=((e,n)=>{return Memory.tasks||(Memory.tasks={}),Memory.tasks[e]||(Memory.tasks[e]={}),Memory.tasks[e][n]||(Memory.tasks[e][n]={}),Memory.tasks[e][n]}),e.clearMemory=((e,n)=>{Memory.tasks[e]&&Memory.tasks[e][n]&&delete Memory.tasks[e][n]}),e.cache=((e,a)=>{return n[e]||(n[e]={}),n[e][a]||(n[e][a]={}),n[e][a]}),e.clearCache=((e,a)=>{n[e]&&n[e][a]&&delete n[e][a]}),e.spawn=((e,n,a,o)=>{let r=a.explicit?Game.rooms[a.explicit]:Room.findSpawnRoom(a);if(!r)return null;n||(n={}),!n.room&&a.targetRoom&&(n.room=a.targetRoom);let t=Creep.compileBody(r,e),s=`${e.name||e.behaviour}-${n.targetName}`,d={parts:t,name:s,behaviour:e.behaviour,destiny:n,queueRoom:r.name};if(0===d.parts.length)return global.logSystem(flag.pos.roomName,dye(CRAYON.error,`${n.task} task tried to queue a zero parts body ${e.behaviour} creep. Aborted.`)),null;let l=r["spawnQueue"+e.queue]||r.spawnQueueLow;return l.push(d),o&&o(d),d});const n={};
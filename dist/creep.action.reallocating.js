let e=new Creep.Action("reallocating");module.exports=e,e.maxPerTarget=1,e.maxPerAction=1,e.getLabOrder=function(e){if(!e)return null;var r=null;let t=e.room;if(!t.memory||!t.memory.resources)return null;let a=t.memory.resources.lab.find(r=>r.id==e.id);if(a){let e=a.orders;for(var n=0;n<e.length;n++)if(e[n].type!=RESOURCE_ENERGY&&(e[n].orderRemaining>0||e[n].storeAmount>0)){r=e[n];break}}return r},e.findNeeding=function(e,r,t,a){t||(t=1);const n=e.structures.labs.all;if(n.length>0)for(let o=0;o<n.length;o++){const e=Game.getObjectById(n[o].id);let i=0;if(e&&(i=e.getNeeds(r)),i>=t&&(0===e.mineralAmount||e.mineralType==r||r==RESOURCE_ENERGY)&&e.id!=a)return{structure:e,amount:i}}const i=e.structures.powerSpawns.all;if(i.length>0)for(let o=0;o<i.length;o++){const e=Game.getObjectById(i[o].id);let n=0;if(e&&(n=e.getNeeds(r)),n>=t&&(r==RESOURCE_POWER||r==RESOURCE_ENERGY)&&e.id!=a)return{structure:e,amount:n}}const c=e.structures.container.all;if(c.length>0)for(let o=0;o<c.length;o++){const e=Game.getObjectById(c[o].id);let n=0;if(e&&(n=e.getNeeds(r)),n>=t&&e.id!=a)return{structure:e,amount:n}}const u=e.terminal;if(u){let e=u.getNeeds(r);if(e>=t&&u.id!=a)return{structure:u,amount:e}}let m=e.storage;if(m){let e=m.getNeeds(r);if(e>=t&&m.id!=a)return{structure:m,amount:e}}return m&&(r==RESOURCE_ENERGY||r==RESOURCE_POWER)&&m.storeCapacity-m.sum>t?{structure:m,amount:0}:u&&r!=RESOURCE_ENERGY&&r!=RESOURCE_POWER&&u.storeCapacity-u.sum>t?{structure:u,amount:0}:null},e.newTargetLab=function(e){let r=e.room,t=r.memory;if(t&&t.labs&&t.labs.length>0)for(var a=0;a<t.labs.length;a++){let i=t.labs[a],c=Game.getObjectById(i.id);if(c){var n=0;if(c.mineralAmount>0){if(n=c.getNeeds(c.mineralType),n<0){var o;if(DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,structureId:c.id,resourceType:c.mineralType,needs:n}),o=this.findNeeding(r,c.mineralType))return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:o.structure.id,resourceType:c.mineralType,targetNeeds:o.amount}),c}if(n>0){if(DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,structureId:c.id,resourceType:c.mineralType,needs:n}),r.storage&&r.storage.store[c.mineralType])return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:r.storage.id,resourceType:c.mineralType,targetNeeds:r.storage.store[c.mineralType]}),e.data.reallocating=c.mineralType,r.storage;if(r.terminal&&r.terminal.getNeeds(c.mineralType)<0)return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:r.terminal.id,resourceType:c.mineralType,targetNeeds:r.terminal.store[c.mineralType]}),e.data.reallocating=c.mineralType,r.terminal;let t=r.findContainerWith(c.mineralType);if(t)return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:t.structure.id,resourceType:c.mineralType,targetNeeds:t.amount}),e.data.reallocating=c.mineralType,t.structure;ROOM_TRADING&&c.mineralType!=RESOURCE_ENERGY&&c.mineralType!=r.mineralType&&r.placeRoomOrder(c.id,c.mineralType,n)}}else{let t=this.getLabOrder(c),a=null;if(t){a=t.type;var n=t.orderRemaining+t.storeAmount;if(DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,structureId:c.id,resourceType:a,needs:n}),r.storage&&r.storage.store[a])return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:r.storage.id,resourceType:a,targetNeeds:r.storage.store[a]}),e.data.reallocating=a,r.storage;if(r.terminal&&r.terminal.getNeeds(a)<0)return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:r.terminal.id,resourceType:a,targetNeeds:r.terminal.store[a]}),e.data.reallocating=a,r.terminal;let o=r.findContainerWith(a);if(o)return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:o.structure.id,resourceType:a,targetNeeds:o.amount}),e.data.reallocating=a,o.structure;ROOM_TRADING&&a!=RESOURCE_ENERGY&&a!=r.mineralType&&r.placeRoomOrder(c.id,a,t.orderRemaining)}}if(n=c.getNeeds(RESOURCE_ENERGY),n<0){DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,structureId:c.id,resourceType:RESOURCE_ENERGY,needs:n});var o=this.findNeeding(r,RESOURCE_ENERGY);if(o)return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:o.structure.id,resourceType:RESOURCE_ENERGY,targetNeeds:o.amount}),c}if(n>0){if(DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,structureId:c.id,resourceType:RESOURCE_ENERGY,needs:n}),r.storage&&r.storage.charge>.5)return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:r.storage.id,resourceType:RESOURCE_ENERGY,targetNeeds:r.storage.store[RESOURCE_ENERGY]}),e.data.reallocating=RESOURCE_ENERGY,r.storage;if(r.terminal&&r.terminal.getNeeds(RESOURCE_ENERGY)<0)return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:r.terminal.id,resourceType:RESOURCE_ENERGY,targetNeeds:r.terminal.store[RESOURCE_ENERGY]}),e.data.reallocating=RESOURCE_ENERGY,r.terminal;let t=r.findContainerWith(RESOURCE_ENERGY);if(t)return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:t.structure.id,resourceType:RESOURCE_ENERGY,targetNeeds:t.amount}),e.data.reallocating=RESOURCE_ENERGY,t.structure}}}return null},e.newTargetPowerSpawn=function(e){const r=e.room,t=r.structures.powerSpawns.all;if(t.length>0)for(var a=0;a<t.length;a++){const o=Game.getObjectById(t[a].id);if(o){var n=0;if(n=o.getNeeds(RESOURCE_ENERGY),n>0){if(DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,structureId:o.id,resourceType:RESOURCE_ENERGY,needs:n}),r.storage&&r.storage.charge>.5)return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:r.storage.id,resourceType:RESOURCE_ENERGY,targetNeeds:r.storage.store[RESOURCE_ENERGY]}),e.data.reallocating=RESOURCE_ENERGY,r.storage;if(r.terminal&&r.terminal.getNeeds(RESOURCE_ENERGY)<0)return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:r.terminal.id,resourceType:RESOURCE_ENERGY,targetNeeds:r.terminal.store[RESOURCE_ENERGY]}),e.data.reallocating=RESOURCE_ENERGY,r.terminal;let t=r.findContainerWith(RESOURCE_ENERGY);if(t)return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:t.structure.id,resourceType:RESOURCE_ENERGY,targetNeeds:t.amount}),e.data.reallocating=RESOURCE_ENERGY,t.structure}if(n=o.getNeeds(RESOURCE_POWER),n>0){if(DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,structureId:o.id,resourceType:RESOURCE_POWER,needs:n}),r.storage&&r.storage.store[RESOURCE_POWER])return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:r.storage.id,resourceType:RESOURCE_POWER,targetNeeds:r.storage.store[RESOURCE_POWER]}),e.data.reallocating=RESOURCE_POWER,r.storage;if(r.terminal&&r.terminal.getNeeds(RESOURCE_POWER)<0)return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:r.terminal.id,resourceType:RESOURCE_POWER,targetNeeds:r.terminal.store[RESOURCE_POWER]}),e.data.reallocating=RESOURCE_POWER,r.terminal;let t=r.findContainerWith(RESOURCE_POWER);if(t)return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:t.structure.id,resourceType:RESOURCE_POWER,targetNeeds:t.amount}),e.data.reallocating=RESOURCE_POWER,t.structure}}}return null},e.newTargetContainer=function(e){const r=e.room,t=r.structures.container.all;if(t.length>0)for(var a=0;a<t.length;a++){const u=Game.getObjectById(t[a].id);if(u){for(var n in u.store){var o=u.getNeeds(n);if(n&&o<0){DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,structureId:u.id,resourceType:n,needs:o});var i=this.findNeeding(r,n);if(i)return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:i.structure.id,resourceType:n,targetNeeds:i.amount}),e.data.reallocating=n,u}}if(r.memory.resources){let t=r.memory.resources.container.find(e=>e.id==u.id);if(t){let a=t.orders;for(var c=0;c<a.length;c++){let t=a[c].type,o=u.getNeeds(t);if(o>0){if(DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,structureId:u.id,resourceType:n,needs:o}),r.storage&&r.storage.store[t]&&!(t==RESOURCE_ENERGY&&r.storage.charge<.5))return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:r.storage.id,resourceType:n,targetNeeds:r.storage.store[n]}),e.data.reallocating=n,r.storage;if(r.terminal&&r.terminal.getNeeds(t)<0)return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:r.terminal.id,resourceType:n,targetNeeds:r.terminal.store[n]}),e.data.reallocating=n,r.terminal}}}}}}return null},e.newTargetTerminal=function(e){let r=e.room,t=e.room.terminal;if(t){for(var a in t.store){let n=-t.getNeeds(a);if(n>0){DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,structureId:t.id,resourceType:a,needs:-n});let o=this.findNeeding(r,a,1,t.id);if(o&&o.structure.id!=t.id)return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:o.structure.id,resourceType:a,targetNeeds:o.amount}),e.data.reallocating=a,t}}if(r.memory.resources&&r.memory.resources.terminal[0]){let a=r.memory.resources.terminal[0].orders.slice();a.push(RESOURCE_ENERGY);let o=null,i=0;for(var n=0;n<a.length;n++)if(o=a[n].type,i=t.getNeeds(o),i>0&&(DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,structureId:t.id,resourceType:o,needs:i}),r.storage&&r.storage.store[o]&&!(o==RESOURCE_ENERGY&&r.storage.charge<.5)))return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:r.storage.id,resourceType:o,targetNeeds:r.storage.store[o]}),e.data.reallocating=o,r.storage}}return null},e.newTargetStorage=function(e){let r=e.room,t=e.room.storage;if(t)for(var a in t.store){let n=-t.getNeeds(a);if(a&&n>0){DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,structureId:t.id,resourceType:a,needs:-n});let o=this.findNeeding(r,a,1,t.id);if(o)return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,targetStructureId:o.structure.id,resourceType:a,targetNeeds:o.amount}),e.data.reallocating=a,t}}return null},e.isValidAction=function(e){return!0},e.isValidTarget=function(e){return!0},e.isAddableAction=function(e){let r=e.room.population;return 0==e.sum&&(!r||!r.actionCount[this.name]||r.actionCount[this.name]<this.maxPerAction)},e.isAddableTarget=function(e){return!0},e.newTarget=function(e){let r=e.room;DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,subAction:"newTarget"});let t=null;if(0==e.sum){let a=r.memory;return a&&(t=this.newTargetLab(e),null===t&&(t=this.newTargetPowerSpawn(e)),null===t&&(t=this.newTargetContainer(e)),null===t&&(t=this.newTargetTerminal(e)),null===t&&(t=this.newTargetStorage(e))),t}{let t=Object.keys(e.carry)[0],a=this.findNeeding(r,t);return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:r.name,creepName:e.name,subAction:"assignDropOff",targetStructureId:a.structure.id,resourceType:t,targetNeeds:a.amount}),a?a.structure:null}},e.cancelAction=function(e){delete e.data.actionName,delete e.data.targetId,e.action=null,e.target=null,delete e.data.path},e.unloadStructure=function(e,r,t,a){var n=Math.min(a,e.carryCapacity-e.sum);let o=e.withdraw(r,t,n);return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:e.room.name,creepName:e.name,subAction:"unloadStructure",structureId:r.id,resourceType:t,amount:n,result:o}),o},e.loadStructure=function(e,r,t,a){var n=null;let o=e.room;var i=Math.min(a,e.carry[t]||0);if(i>0&&(n=e.transfer(r,t,i)),n==OK){let e=null;if(o.memory.resources&&(e=o.memory.resources[r.structureType].find(e=>e.id==r.id)),e&&e.orders){let r=e.orders.find(e=>e.type==t);r&&r.orderRemaining>0&&(r.orderRemaining-=i)}}return DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:e.room.name,creepName:e.name,subAction:"loadStructure",structureId:r.id,resourceType:t,amount:i,result:n}),n},e.assignDropOff=function(e,r){let t=this.findNeeding(e.room,r,1,e.target.id);t&&(DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",roomName:e.room.name,creepName:e.name,subAction:"assignDropOff",targetStructureId:t.structure.id,resourceType:r,amount:t.amount}),this.assign(e,t.structure))},e.unloadLab=function(e){let r=e.target;var t=null,a=null,n=0;return n=-r.getNeeds(RESOURCE_ENERGY),n>0&&(a=RESOURCE_ENERGY),a||(n=-r.getNeeds(r.mineralType),n>0&&(a=r.mineralType)),a&&(t=this.unloadStructure(e,r,a,n)),DEBUG&&TRACE&&trace("Action",{actionName:"reallocating-unloadLab",roomName:room.name,creepName:e.name,structureId:r.id,resourceType:a,needs:n,workResult:t}),t==OK?this.assignDropOff(e,a):this.cancelAction(e),t},e.unloadPowerSpawn=function(e){let r=e.target;var t=null,a=null,n=0;return n=-r.getNeeds(RESOURCE_ENERGY),n>0&&(a=RESOURCE_ENERGY),a||(n=-r.getNeeds(RESOURCE_POWER),n>0&&(a=RESOURCE_POWER)),a&&(t=this.unloadStructure(e,r,a,n)),DEBUG&&TRACE&&trace("Action",{actionName:"reallocating-unloadPowerSpawn",roomName:room.name,creepName:e.name,structureId:r.id,resourceType:a,needs:n,workResult:t}),t==OK?this.assignDropOff(e,a):this.cancelAction(e),t},e.unloadContainer=function(e){let r=e.target;var t=null,a=null,n=0;let o=Object.keys(r.store);e.data.reallocating&&(o.unshift(e.data.reallocating),delete e.data.reallocating);for(let i=0;i<o.length;i++){let e=o[i];if(e&&r.store[e]>0&&(r.structureType==STRUCTURE_LAB||r.getNeeds(e)<0)){let t=this.findNeeding(room,e,1,r.id);if(t&&(n=t.amount),n>0){a=e;break}if(storage&&t&&t.structure.structureType==STRUCTURE_STORAGE&&e==RESOURCE_ENERGY){n=storage.storeCapacity-storage.sum,a=e;break}}}return a&&(t=this.unloadStructure(e,r,a,n)),DEBUG&&TRACE&&trace("Action",{actionName:"reallocating-unloadContainer",roomName:room.name,creepName:e.name,structureId:r.id,resourceType:a,needs:n,workResult:t}),t==OK?this.assignDropOff(e,a):this.cancelAction(e),t},e.unloadTerminal=function(e){let r=e.target,t=e.room,a=t.storage;var n=null,o=null,i=0;let c=Object.keys(r.store);e.data.reallocating&&(c.unshift(e.data.reallocating),delete e.data.reallocating);for(let u=0;u<c.length;u++){let e=c[u];if(e&&r.store[e]>0&&(r.structureType==STRUCTURE_LAB||r.getNeeds(e)<0)){let n=this.findNeeding(t,e,1,r.id);if(n&&(i=n.amount),i>0){o=e;break}if(a&&n&&n.structure.structureType==STRUCTURE_STORAGE&&e==RESOURCE_ENERGY){i=a.storeCapacity-a.sum,o=e;break}}}return o&&(i=Math.min(i,r.store[o]||0,e.carryCapacity-e.sum),n=this.unloadStructure(e,r,o,i)),DEBUG&&TRACE&&trace("Action",{actionName:"reallocating-unloadTerminal",roomName:t.name,creepName:e.name,structureId:r.id,resourceType:o,needs:i,workResult:n}),n==OK?this.assignDropOff(e,o):this.cancelAction(e),n},e.unloadStorage=function(e){let r=e.target,t=e.room,a=t.terminal;var n=null,o=null,i=0;let c=Object.keys(r.store);e.data.reallocating&&(c.unshift(e.data.reallocating),delete e.data.reallocating);for(let u=0;u<c.length;u++){let n=c[u];if(n&&r.store[n]>0){if(n==RESOURCE_ENERGY&&r.charge<.5)continue;let c=this.findNeeding(t,n,1,r.id);if(DEBUG&&TRACE&&trace("Action",{actionName:"reallocating",subAction:"findNeeding",roomName:t.name,creepName:e.name,structureId:c&&c.structure.id,resourceType:n,amount:c&&c.amount}),c&&c.structure.id==r.id&&(c=null),c&&(i=c.amount),i>0){o=n;break}if(a&&c&&c.structure.structureType==STRUCTURE_TERMINAL&&n!=RESOURCE_ENERGY&&n!=RESOURCE_POWER){i=a.storeCapacity-a.sum,o=n;break}}}return o&&(i=Math.min(i,r.store[o]||0,e.carryCapacity-e.sum),n=this.unloadStructure(e,r,o,i)),DEBUG&&TRACE&&trace("Action",{actionName:"reallocating-unloadStorage",roomName:t.name,creepName:e.name,structureId:r.id,resourceType:o,needs:i,workResult:n}),n==OK?this.assignDropOff(e,o):this.cancelAction(e),n},e.loadLab=function(e){let r=e.target,t=e.room;var a=null,n=null,o=0;if(o=r.getNeeds(RESOURCE_ENERGY),o>0&&(e.carry.energy||0)>0)n=RESOURCE_ENERGY;else{let t=this.getLabOrder(r);t&&(n=t.type),o=r.getNeeds(n),o>0&&(e.carry[n]||0)>0||(n=null)}return n&&(a=this.loadStructure(e,r,n,o)),DEBUG&&TRACE&&trace("Action",{actionName:"reallocating-loadLab",roomName:t.name,creepName:e.name,structureId:r.id,resourceType:n,needs:o,workResult:a}),(e.carry[n]||0)>o?this.assignDropOff(e,n):this.cancelAction(e),a},e.loadPowerSpawn=function(e){let r=e.target,t=e.room;var a=null,n=null,o=0;return t.memory.resources&&void 0===t.memory.resources.powerSpawn&&(t.memory.resources.powerSpawn=[]),o=r.getNeeds(RESOURCE_ENERGY),o>0&&(e.carry.energy||0)>0?n=RESOURCE_ENERGY:(o=r.getNeeds(RESOURCE_POWER),o>0&&(e.carry[RESOURCE_POWER]||0)>0&&(n=RESOURCE_POWER)),n&&(a=this.loadStructure(e,r,n,o)),DEBUG&&TRACE&&trace("Action",{actionName:"reallocating-loadPowerSpawn",roomName:t.name,creepName:e.name,structureId:r.id,resourceType:n,needs:o,workResult:a}),(e.carry[n]||0)>o?this.assignDropOff(e,n):this.cancelAction(e),a},e.loadContainer=function(e){let r=e.target,t=e.room;var a=null,n=null,o=0;for(var i in e.carry)if((!i||0!=e.carry[i])&&(o=r.getNeeds(i),o>0)){n=i;break}return n&&(a=this.loadStructure(e,r,n,o)),DEBUG&&TRACE&&trace("Action",{actionName:"reallocating-loadContainer",roomName:t.name,creepName:e.name,structureId:r.id,resourceType:n,needs:o,workResult:a}),(e.carry[n]||0)>o?this.assignDropOff(e,n):this.cancelAction(e),a},e.loadTerminal=function(e){let r=e.target,t=e.room;var a=null,n=null,o=0;for(var i in e.carry)if(!i||0!=e.carry[i]){if(o=r.getNeeds(i),o>0){n=i;break}if(i!=RESOURCE_ENERGY&&i!=RESOURCE_POWER){n=i,o=r.storeCapacity-r.sum;break}}return n&&(a=this.loadStructure(e,r,n,o)),DEBUG&&TRACE&&trace("Action",{actionName:"reallocating-loadTerminal",roomName:t.name,creepName:e.name,structureId:r.id,resourceType:n,needs:o,workResult:a}),(e.carry[n]||0)>o?this.assignDropOff(e,n):this.cancelAction(e),a},e.loadStorage=function(e){let r=e.target,t=e.room;var a=null,n=null,o=0;for(var i in e.carry)if((!i||0!=e.carry[i])&&(o=r.getNeeds(i),o>0)){n=i;break}return n&&(a=this.loadStructure(e,r,n,o)),DEBUG&&TRACE&&trace("Action",{actionName:"reallocating-loadStorage",roomName:t.name,creepName:e.name,structureId:r.id,resourceType:n,needs:o,workResult:a}),(e.carry[n]||0)>o?this.assignDropOff(e,n):this.cancelAction(e),a},e.work=function(e){var r=null;let t=e.room,a=e.target;t.storage,t.terminal;if(0==e.sum)switch(a.structureType){case STRUCTURE_LAB:r=this.unloadLab(e);break;case STRUCTURE_POWER_SPAWN:this.cancelAction(e);break;case STRUCTURE_CONTAINER:r=this.unloadContainer(e);break;case STRUCTURE_TERMINAL:r=this.unloadTerminal(e);break;case STRUCTURE_STORAGE:r=this.unloadStorage(e);break;default:this.cancelAction(e)}else switch(a.structureType){case STRUCTURE_LAB:r=this.loadLab(e);break;case STRUCTURE_POWER_SPAWN:r=this.loadPowerSpawn(e);break;case STRUCTURE_CONTAINER:r=this.loadContainer(e);break;case STRUCTURE_TERMINAL:r=this.loadTerminal(e);break;case STRUCTURE_STORAGE:r=this.loadStorage(e);break;default:this.cancelAction(e)}return r};
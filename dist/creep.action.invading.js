let t=new Creep.Action("invading");module.exports=t,t.isValidAction=function(t){return FlagDir.hasInvasionFlag()},t.isAddableAction=function(){return!0},t.isAddableTarget=function(){return!0},t.getFlaggedStructure=function(t,e){let r=FlagDir.filter(t,e,!0),o=[],n=t=>{var r=Game.flags[t.name];if(r&&r.pos.roomName==e.roomName&&void 0!==r.room){var n=r.room.lookForAt(LOOK_STRUCTURES,r.pos.x,r.pos.y);n&&n.length>0?(addTarget=(t=>{t.destroyFlag=r,o.push(t)}),n.forEach(addTarget)):r.remove()}};return r.forEach(n),o&&o.length>0?e.findClosestByRange(o):null},t.newTarget=function(t){var e=this.getFlaggedStructure(FLAG_COLOR.destroy,t.pos);if(e)return e.destroyFlag&&Population.registerCreepFlag(t,e.destroyFlag),e;var r=FlagDir.find(FLAG_COLOR.invade,t.pos,!1);if(r&&(!r.room||r.pos.roomName!=t.pos.roomName))return Population.registerCreepFlag(t,r),r;if(!r)return t.action=null,delete t.data.actionName,void delete t.data.targetId;if(!r.room.controller||!r.room.controller.my){var o=t.pos.findClosestByRange(t.room.hostiles,{function(t){return _.some(t.body,{type:HEAL})}});if(o)return o;if(o=t.pos.findClosestByRange(t.room.hostiles,{function(t){return _.some(t.body,function(t){return t.type==ATTACK||t.type==RANGED_ATTACK})}}))return o;if(o=t.pos.findClosestByPath(FIND_HOSTILE_STRUCTURES,{filter:t=>{return t.structureType==STRUCTURE_TOWER}}))return o;if(o=t.pos.findClosestByRange(t.room.hostiles))return o;if(o=t.pos.findClosestByPath(FIND_HOSTILE_STRUCTURES,{filter:t=>{return t.structureType==STRUCTURE_SPAWN}}))return o;if(o=t.pos.findClosestByPath(FIND_HOSTILE_STRUCTURES,{filter:t=>{return t.structureType!=STRUCTURE_CONTROLLER}}))return o;if(o=t.pos.findClosestByPath(FIND_HOSTILE_CONSTRUCTION_SITES))return o}return r.remove(),null},t.step=function(t){global.CHATTY&&t.say(this.name),t.target instanceof Flag&&t.target.pos.roomName==t.pos.roomName&&this.assign(t),this.run[t.data.creepType](t)},t.run={melee:function(t){if(!t.flee){if(t.target instanceof Flag)return void t.travelTo(t.target);if(t.target instanceof ConstructionSite)return void t.travelTo(t.target,{range:0});t.travelTo(t.target)}t.target.my||(t.attacking=t.attack(t.target)==OK)},ranger:function(t){var e=t.pos.getRangeTo(t.target);if(!t.flee){if(t.target instanceof Flag)return void t.travelTo(t.target);if(t.target instanceof ConstructionSite)return void t.travelTo(t.target,{range:0});e>3&&t.travelTo(t.target),e<3&&t.move(t.target.pos.getDirectionTo(t))}var r=t.pos.findInRange(t.room.hostiles,3);return r.length>2?(global.CHATTY&&t.say("MassAttack"),void(t.attackingRanged=t.rangedMassAttack()==OK)):e<4?void(t.attackingRanged=t.rangedAttack(t.target)==OK):void(r.length>0&&(t.attackingRanged=t.rangedAttack(r[0])==OK))}},t.defaultStrategy.moveOptions=function(t){return _.isUndefined(t.allowHostile)&&(t.allowHostile=!0),t};